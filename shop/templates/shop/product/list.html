{% extends "shop/base.html" %}
{% load static %}
{% block title %}
    {% if category %}{{ category.name }}{% else %}Наклейки{% endif %}
{% endblock %}
{% block content %}
    <div class="md:hidden">
        {% with total_items=cart|length %}
            {% if cart|length > 0 %}
                <a href="{% url "cart:cart_detail" %}"
                   class="z-50 fixed bottom-6 right-6 rounded-full shadow-md px-6 py-1 bg-red-400 border text-lg md:text-sm text-white font-light">
                    {{ cart.get_total_price }} ₽
                </a>
            {% endif %}
        {% endwith %}
    </div>
    <div class="mt-6">
        <div class="" id="categories">
            <ul class="flex justify-center">
                <li class="mx-2 sm:mx-6">
                    <a class="text-lg" {% if not category %} class="text-red-400 font-medium"{% endif %}
                       href="{% url "shop:product_list" %}">
                        <img class="w-8 md:w-10 mx-auto" src="/media/all_cat.png" alt="">
                        <div class="text-xs text-center pt-2">Все</div>
                    </a>
                </li>
                {% for c in categories %}
                    <li class="mx-2 sm:mx-4 items-center text-center justify-center">
                        <a {% if category.slug == c.slug %}class="text-red-400 font-medium"{% endif %}
                           href="{{ c.get_absolute_url }}">
                            {% if c.icon %}
                                <img class="w-8 md:w-10 mx-auto pt-2" src="{{ c.icon.url }}" alt="Категория">
                                <div class="text-xs">{{ c.name }}</div>
                            {% else %}
                                {{ c.name }}
                            {% endif %}
                        </a>
                    </li>
                {% endfor %}
            </ul>
            <h2 class="text-3xl text-center mt-4">
                {% if category %}{{ category.name }}{% else %}Все наклейки{% endif %}
            </h2>
        </div>

        {% for item in cart %}

        {% endfor %}



        <!-- Товары -->
        <section class="container p-3 mx-auto">
            <div class="infinite-container grid gap-y-8 gap-4 md:gap-6 md:gap-y-8 m-4 mb-16 md:m-16 grid-cols-2 sm:grid-cols-3 md::grid-cols-4 lg:grid-cols-5 xl:grid-cols-6">
                {% for product in products %}
                    <!-- Карточка товара -->
                    <div class="infinite-item">
                        <div class="flex square md:w-auto relative bg-gray-100 rounded-lg">
                            <div class="p-2 items-center">
                                <img
                                        alt="{{ product.name }}"
                                        class="rounded object-contain"
                                        loading="lazy"
                                        src="
                                        {% if product.image %}{{ product.image.url }}
                                        {% else %}{% static "img/no_image.png" %}
                                        {% endif %}"
                                >
                            </div>
                        </div>
                        <div class="h-12 p-2 text-sm font-medium md:text-md leading-tight">
                            {{ product.name }}
                        </div>
                        <form class="flex items-center mx-2" action="{% url "cart:cart_add" product.id %}"
                              method="post">
                            <input type="hidden" name="next" value="/shop/{{ category.slug }}">
                            {{ cart_product_form }}
                            {% csrf_token %}
                            <div class="flex flex-grow justify-left">
                                <div class="flex rounded-full p-1 border items-center bg-white">
                                    <button class="h-5 w-5 md:h-6 md:w-6 rounded-full hover:bg-blue-200 bg-white z-50" type="button"
                                            onclick="this.nextElementSibling.stepDown(); this.nextElementSibling.onchange();">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                             stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M18 12H6"></path>
                                        </svg>
                                    </button>
                                    <input class="text-xs md:text-sm -mx-3 md:-mx-2 w-12 h-5 border-0 text-center appearance-none rounded"
                                           name="quantity"
                                           type="number"
                                           min="25"
                                           value="25"
                                           step="25" readonly>
                                    <button class="h-5 w-5 md:h-6 md:w-6 rounded-full hover:bg-blue-200" type="button"
                                            onclick="this.previousElementSibling.stepUp(); this.previousElementSibling.onchange();">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                             stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="flex flex-none items-center">{% for item in cart %}{% if product == item.product %}
                                <button type="submit"
                                        class="h-8 px-2 rounded-full border flex text-white text-xs items-center bg-red-400">
                                    {{ item.quantity }} шт.
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none"
                                         viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                </button>
                            {% endif %}
                            {% endfor %}
                                <button class="h-8 w-8 px-2 rounded-full border hover:bg-red-400 hover:text-white
                                           {% for item in cart %}
                                    {% if product == item.product %}
                                    hidden
                                        {% endif %}
                                {% endfor %}
                                        " type="submit">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                         viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                </button>
                            </div>
                        </form>
                    </div>
                    <!-- Конец карточки -->
                {% endfor %}
            </div>
            <div class="flex flex-col mx-auto mb-8 items-center justify-center p-4">
                <div class="loading text-center" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" class="animate-spin h-6 w-6" fill="none" viewBox="0 0 24 24"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                </div>

                {% if page_obj.has_next %}
                    <a class="infinite-more-link text-center" href="?page={{ page_obj.next_page_number }}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M19 13l-7 7-7-7m14-8l-7 7-7-7"/>
                        </svg>
                    </a>
                {% endif %}
            </div>
        </section>


        <script>
            var infinite = new Waypoint.Infinite({
                element: $('.infinite-container')[0],
                onBeforePageLoad: function () {
                    $('.loading').show();
                },
                onAfterPageLoad: function ($items) {
                    $('.loading').hide();
                }
            });
        </script>

    </div>
{% endblock %}
